<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tariff Stacking Decision Tree - TariffOptimizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            flex-wrap: nowrap;
        }

        .nav-tab {
            flex: 1 1 0;
            padding: 12px 8px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .content {
            padding: 30px;
            min-height: 600px;
        }

        .tree-section {
            display: none;
        }

        .tree-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tree-node {
            margin: 15px 0;
            padding: 15px;
            border-left: 4px solid #667eea;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .tree-node.decision {
            border-left-color: #ffc107;
            background: #fff9e6;
        }

        .tree-node.action {
            border-left-color: #28a745;
            background: #e8f5e9;
        }

        .tree-node.exempt {
            border-left-color: #17a2b8;
            background: #e0f7fa;
        }

        .tree-node.applies {
            border-left-color: #dc3545;
            background: #ffebee;
        }

        .tree-node.not-applicable {
            border-left-color: #6c757d;
            background: #f1f3f5;
        }

        .node-label {
            font-weight: 700;
            color: #212529;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .node-content {
            font-size: 14px;
            color: #495057;
            line-height: 1.6;
        }

        .node-code {
            display: inline-block;
            background: rgba(0, 0, 0, 0.05);
            padding: 2px 8px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 5px 5px 5px 0;
        }

        .indent-1 { margin-left: 30px; }
        .indent-2 { margin-left: 60px; }
        .indent-3 { margin-left: 90px; }
        .indent-4 { margin-left: 120px; }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 30px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }

        .legend-color.decision { background: #fff9e6; border: 3px solid #ffc107; }
        .legend-color.action { background: #e8f5e9; border: 3px solid #28a745; }
        .legend-color.exempt { background: #e0f7fa; border: 3px solid #17a2b8; }
        .legend-color.applies { background: #ffebee; border: 3px solid #dc3545; }
        .legend-color.not-applicable { background: #f1f3f5; border: 3px solid #6c757d; }

        .stacking-order {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .stacking-order h3 {
            margin-bottom: 15px;
            font-size: 20px;
        }

        .stacking-order ol {
            margin-left: 20px;
            line-height: 2;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }

        .hts-code-toggle {
            background: #FF6600;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            margin-top: 10px;
        }

        .hts-code-toggle:hover {
            background: #FF8533;
        }

        .hts-code-list {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            max-height: 400px;
            overflow-y: auto;
        }

        .hts-code-list.expanded {
            display: block;
        }

        .hts-code-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .hts-code-item {
            background: white;
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            text-align: center;
        }

        .info-box strong {
            color: #1976d2;
        }

        .back-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            transition: background 0.3s;
        }

        .back-link:hover {
            background: #764ba2;
        }

        code {
            background: #f1f3f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .formula {
            background: #fff;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>üìä CBP Tariff Stacking Decision Tree</h1>
                    <p>Complete deterministic logic for Chapter 98/99 punitive tariffs</p>
                </div>
                <div style="text-align: right;">
                    <a href="{{ url_for('index') }}" style="color: white; text-decoration: underline; margin-right: 15px;">‚Üê Home</a>
                    <a href="{{ url_for('logout') }}" style="color: white; text-decoration: underline;">Logout</a>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">Overview</button>
            <button class="nav-tab" onclick="showTab('exemption-codes')">Section 98/99 Codes</button>
            <button class="nav-tab" onclick="showTab('section232-steel')">232 Steel</button>
            <button class="nav-tab" onclick="showTab('section232-aluminum')">232 Aluminum</button>
            <button class="nav-tab" onclick="showTab('section232-copper')">232 Copper</button>
            <button class="nav-tab" onclick="showTab('section232-lumber')">232 Lumber</button>
            <button class="nav-tab" onclick="showTab('section232-automotive')">232 Automotive</button>
            <button class="nav-tab" onclick="showTab('section232-buses')">232 Buses</button>
            <button class="nav-tab" onclick="showTab('section301')">Section 301</button>
            <button class="nav-tab" onclick="showTab('ieepa-reciprocal')">IEEPA Reciprocal</button>
            <button class="nav-tab" onclick="showTab('ieepa-fentanyl')">IEEPA Fentanyl</button>
        </div>

        <div class="content">
            <!-- Repository Status Check -->
            <div id="repo-status-container" style="background: linear-gradient(135deg, #059BD2 0%, #004459 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; font-size: 18px; font-weight: 500;">üìö Budget Lab Yale Repository Monitor</h3>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="toggleRepoDetails()" id="toggle-repo-btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: 14px; display: none;">
                            ‚ñº Collapse
                        </button>
                        <button onclick="checkYaleRepository()" id="check-repo-btn" style="background: #FF6600; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: 14px;">
                            üîÑ Check for Updates
                        </button>
                    </div>
                </div>
                <div id="repo-status-content">
                    <p style="margin: 0; opacity: 0.9; font-size: 14px;">Click "Check for Updates" to monitor the Budget Lab Yale Tariff-ETRs repository for the latest tariff logic changes.</p>
                </div>
                <div id="repo-details-content" style="display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.2);"></div>
            </div>

            <!-- Overview Tab -->
            <div id="overview" class="tree-section active">
                <div class="stacking-order">
                    <h3>üî¢ CBP Stacking Order (Critical!)</h3>
                    <p><strong>‚ö†Ô∏è UPDATED August 2025 per CSMS #65829726</strong></p>
                    <p>Tariffs must be applied in this order:</p>
                    <ol>
                        <li><strong>Section 301</strong> (China tariffs 9903.88.xx) - FIRST</li>
                        <li><strong>IEEPA Fentanyl</strong> (9903.01.36) - SECOND</li>
                        <li><strong>IEEPA Reciprocal</strong> (9903.01.25) - THIRD
                            <ul style="margin-left: 20px; margin-top: 5px; font-size: 14px;">
                                <li>Effective: August 7, 2025 at 12:01 a.m. EDT</li>
                                <li>NEW: Applies to all countries (not just China)</li>
                                <li>NEW: 9903.01.29 - Column 2 countries exempt (BY, CU, KP, RU)</li>
                                <li>NEW: 9903.01.30 - Humanitarian donations exempt</li>
                            </ul>
                        </li>
                        <li><strong>Section 232</strong> - FOURTH
                            <ul style="margin-left: 20px; margin-top: 5px; font-size: 14px;">
                                <li><strong>üö® HTS CODE-BASED (checked FIRST):</strong></li>
                                <li style="margin-left: 20px;">‚úÖ Automotive (8703.*, 8704.*, etc.) - 23.76% effective rate - ACTIVE</li>
                                <li style="margin-left: 20px;">‚úÖ Buses (8702.*) - 10% rate - ACTIVE</li>
                                <li style="margin-top: 10px;"><strong>üì¶ MATERIAL COMPOSITION-BASED (ONLY if NOT automotive/buses):</strong></li>
                                <li style="margin-left: 20px;">‚úÖ Steel (9903.81.xx) - 25% ACTIVE</li>
                                <li style="margin-left: 20px;">‚úÖ Aluminum (9903.85.xx) - 10% ACTIVE</li>
                                <li style="margin-left: 20px;">‚úÖ Copper derivatives - 50% ACTIVE (44 HTS codes)</li>
                                <li style="margin-left: 20px;">‚úÖ Lumber/Softwood (Chapter 44) - 10% ACTIVE (~15 HTS codes)</li>
                                <li style="margin-top: 10px;"><em>‚ö†Ô∏è Section 232 metals are MUTUALLY EXCLUSIVE with IEEPA Reciprocal</em></li>
                                <li><em>‚ö†Ô∏è HTS-based 232 (automotive/buses) are MUTUALLY EXCLUSIVE with material-based 232</em></li>
                            </ul>
                        </li>
                    </ol>
                    <div class="info-box" style="margin-top: 15px;">
                        <strong>üìã Source:</strong> CBP CSMS #65829726 - Reciprocal Tariff Guidance<br>
                        <strong>Order:</strong> "301, Fentanyl, Reciprocal, 232/201"
                    </div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color decision"></div>
                        <span><strong>Decision Point</strong> - Check condition or ask question</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color action"></div>
                        <span><strong>Action</strong> - Calculate or check value</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color exempt"></div>
                        <span><strong>EXEMPT</strong> - Tariff does not apply (exclusion)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color applies"></div>
                        <span><strong>APPLIES</strong> - Tariff applies to product</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color not-applicable"></div>
                        <span><strong>NOT APPLICABLE</strong> - Tariff doesn't apply (0% composition or wrong origin)</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong>‚ÑπÔ∏è How to Read This Tree:</strong>
                    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                        <li>Yellow boxes = Decision points (IF statements)</li>
                        <li>Green boxes = Actions (CALCULATE, ASK)</li>
                        <li>Blue boxes = Exempt outcomes</li>
                        <li>Red boxes = Apply outcomes</li>
                        <li>Gray boxes = Not applicable outcomes</li>
                        <li>Indentation shows nested logic</li>
                    </ul>
                </div>

                <h2 style="margin: 30px 0 20px 0;">Key Concepts</h2>

                <div class="tree-node action">
                    <div class="node-label">Metal vs Non-Metal Split</div>
                    <div class="node-content">
                        <p>For products with mixed composition:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Metal Portion:</strong> Subject to Section 232, exempt from IEEPA Reciprocal</li>
                            <li><strong>Non-Metal Portion:</strong> Subject to IEEPA Reciprocal (as of June 4, 2025)</li>
                            <li><strong>Entry Requirement:</strong> Must report on separate entry summary lines</li>
                        </ul>
                    </div>
                </div>

                <div class="tree-node action">
                    <div class="node-label">Percentage-Based Calculations</div>
                    <div class="node-content">
                        <p>Some tariffs apply only to a portion of product value:</p>
                        <div class="formula">
                            Section 232 Steel: duty = value √ó (steel_pct / 100) √ó rate<br>
                            IEEPA Reciprocal: duty = value √ó (non_metal_pct / 100) √ó rate
                        </div>
                    </div>
                </div>

                <div class="tree-node action">
                    <div class="node-label">US Content Rules</div>
                    <div class="node-content">
                        <p>For IEEPA Reciprocal exemption:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Must have ‚â•20% U.S.-originating content</li>
                            <li>Determined by physical characteristics only (19 U.S.C. ¬ß 1401a)</li>
                            <li>Requires split entry: U.S. portion vs non-U.S. portion</li>
                        </ul>
                    </div>
                </div>

                <a href="/stacking-builder" class="back-link">‚Üê Back to Stacking Builder</a>
            </div>

            <!-- All Exemption Codes Tab -->
            <div id="exemption-codes" class="tree-section">
                <h2>Complete Chapter 99/98 Exemption Codes Reference</h2>

                <div class="info-box">
                    <strong>üìã Quick Reference:</strong> All HTS codes for exemptions and tariffs in the stacking logic
                </div>

                <h3 style="margin-top: 30px;">Section 232 - Steel Tariffs</h3>
                <div class="tree-node applies">
                    <div class="node-label">Tariff Codes (25% rate)</div>
                    <div class="node-content">
                        <span class="node-code">9903.81.04</span>
                        <span class="node-code">9903.81.06</span>
                        <span class="node-code">9903.81.11</span>
                        <span class="node-code">9903.81.12</span>
                        <span class="node-code">9903.81.19</span>
                        <span class="node-code">9903.81.86</span>
                        <span class="node-code">9903.81.87</span>
                    </div>
                </div>

                <div class="tree-node exempt">
                    <div class="node-label">Exemption Codes</div>
                    <div class="node-content">
                        <strong>9903.01.26:</strong> Canadian goods qualifying under USMCA<br>
                        <strong>9903.01.27:</strong> Mexican goods qualifying under USMCA<br>
                        <strong>9903.81.92:</strong> Steel melted and poured in the United States<br>
                        <strong>Product-Specific Exclusions:</strong> Must match Importer of Record (IOR), quantity-limited (GAEs revoked 3/12/25)
                    </div>
                </div>

                <h3 style="margin-top: 30px;">Section 232 - Aluminum Tariffs</h3>
                <div class="tree-node applies">
                    <div class="node-label">Tariff Codes (10% rate)</div>
                    <div class="node-content">
                        <span class="node-code">9903.85.02</span>
                        <span class="node-code">9903.85.04</span>
                        <span class="node-code">9903.85.07</span>
                        <span class="node-code">9903.85.08</span>
                        <span class="node-code">9903.85.09</span>
                    </div>
                </div>

                <div class="tree-node exempt">
                    <div class="node-label">Exemption Codes</div>
                    <div class="node-content">
                        <strong>9903.01.26:</strong> Canadian goods qualifying under USMCA<br>
                        <strong>9903.01.27:</strong> Mexican goods qualifying under USMCA<br>
                        <strong>US Origin:</strong> Aluminum smelted and cast in the United States (no specific 9903 code)<br>
                        <strong>Product-Specific Exclusions:</strong> Must match IOR, quantity-limited (GAEs revoked 3/12/25)
                    </div>
                </div>

                <h3 style="margin-top: 30px;">Section 232 - Copper Derivatives</h3>
                <div class="tree-node applies">
                    <div class="node-label">Tariff Code (50% rate) - ACTIVE</div>
                    <div class="node-content">
                        <strong>Rate:</strong> 50% ad valorem<br>
                        <strong>Coverage:</strong> 44 HTS codes for copper derivatives<br>
                        <em>Based on current CBP guidance and Federal Register notices</em>

                        <button class="hts-code-toggle" onclick="toggleHTSCodes('copper-codes')">
                            ‚ñº Show HTS Codes (44)
                        </button>

                        <div id="copper-codes" class="hts-code-list">
                            <strong>Affected HTS Codes:</strong>
                            <div class="hts-code-grid">
                                <div class="hts-code-item">7401.00.00</div>
                                <div class="hts-code-item">7402.00.00</div>
                                <div class="hts-code-item">7403.11.00</div>
                                <div class="hts-code-item">7403.12.00</div>
                                <div class="hts-code-item">7403.13.00</div>
                                <div class="hts-code-item">7403.19.00</div>
                                <div class="hts-code-item">7403.21.00</div>
                                <div class="hts-code-item">7403.22.00</div>
                                <div class="hts-code-item">7403.29.00</div>
                                <div class="hts-code-item">7404.00.11</div>
                                <div class="hts-code-item">7404.00.12</div>
                                <div class="hts-code-item">7404.00.62</div>
                                <div class="hts-code-item">7405.00.00</div>
                                <div class="hts-code-item">7406.10.00</div>
                                <div class="hts-code-item">7406.20.00</div>
                                <div class="hts-code-item">7407.10.15</div>
                                <div class="hts-code-item">7407.10.50</div>
                                <div class="hts-code-item">7407.21.10</div>
                                <div class="hts-code-item">7407.21.30</div>
                                <div class="hts-code-item">7407.21.50</div>
                                <div class="hts-code-item">7407.21.70</div>
                                <div class="hts-code-item">7407.21.90</div>
                                <div class="hts-code-item">7407.29.11</div>
                                <div class="hts-code-item">7407.29.16</div>
                                <div class="hts-code-item">7407.29.20</div>
                                <div class="hts-code-item">7407.29.40</div>
                                <div class="hts-code-item">7407.29.50</div>
                                <div class="hts-code-item">7408.11.30</div>
                                <div class="hts-code-item">7408.11.60</div>
                                <div class="hts-code-item">7408.19.30</div>
                                <div class="hts-code-item">7408.19.60</div>
                                <div class="hts-code-item">7408.21.00</div>
                                <div class="hts-code-item">7408.22.00</div>
                                <div class="hts-code-item">7408.29.10</div>
                                <div class="hts-code-item">7408.29.50</div>
                                <div class="hts-code-item">7409.11.00</div>
                                <div class="hts-code-item">7409.19.00</div>
                                <div class="hts-code-item">7409.21.00</div>
                                <div class="hts-code-item">7409.29.00</div>
                                <div class="hts-code-item">7409.31.00</div>
                                <div class="hts-code-item">7409.39.00</div>
                                <div class="hts-code-item">7409.40.00</div>
                                <div class="hts-code-item">7409.90.00</div>
                                <div class="hts-code-item">7410.11.00</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tree-node exempt">
                    <div class="node-label">Exemption Codes</div>
                    <div class="node-content">
                        <strong>9903.01.26:</strong> Canadian goods qualifying under USMCA (if applicable)<br>
                        <strong>9903.01.27:</strong> Mexican goods qualifying under USMCA (if applicable)<br>
                        <strong>Note:</strong> Applies to copper portion of product value only
                    </div>
                </div>

                <h3 style="margin-top: 30px;">Section 232 - Lumber/Softwood</h3>
                <div class="tree-node applies">
                    <div class="node-label">Tariff Code (10% rate) - ACTIVE</div>
                    <div class="node-content">
                        <strong>Rate:</strong> 10% ad valorem<br>
                        <strong>Coverage:</strong> 15 HTS codes from Chapter 44 (softwood lumber)<br>
                        <strong>USMCA:</strong> No exemptions available<br>
                        <em>Based on current CBP guidance and Federal Register notices</em>

                        <button class="hts-code-toggle" onclick="toggleHTSCodes('lumber-codes')">
                            ‚ñº Show HTS Codes (15)
                        </button>

                        <div id="lumber-codes" class="hts-code-list">
                            <strong>Affected HTS Codes:</strong>
                            <div class="hts-code-grid">
                                <div class="hts-code-item">4407.11.00</div>
                                <div class="hts-code-item">4407.12.00</div>
                                <div class="hts-code-item">4407.19.00</div>
                                <div class="hts-code-item">4409.10.05</div>
                                <div class="hts-code-item">4409.10.10</div>
                                <div class="hts-code-item">4409.10.20</div>
                                <div class="hts-code-item">4409.10.90</div>
                                <div class="hts-code-item">4418.91.10</div>
                                <div class="hts-code-item">4418.91.50</div>
                                <div class="hts-code-item">4421.99.70</div>
                                <div class="hts-code-item">4421.99.80</div>
                                <div class="hts-code-item">4421.99.90</div>
                                <div class="hts-code-item">4421.99.93</div>
                                <div class="hts-code-item">4421.99.94</div>
                                <div class="hts-code-item">4421.99.97</div>
                            </div>
                        </div>
                    </div>
                </div>

                <h3 style="margin-top: 30px;">Section 232 - Automotive</h3>
                <div class="tree-node applies">
                    <div class="node-label">Tariff Codes (25% base rate, 23.76% effective) - ACTIVE</div>
                    <div class="node-content">
                        <strong>‚úÖ IMPLEMENTED WITH FULL LOGIC</strong><br><br>
                        <strong>4 Subcategories (290+ total HTS codes):</strong><br><br>

                        1. <strong>Passenger vehicles & light trucks</strong> - 16 HTS codes
                        <button class="hts-code-toggle" onclick="toggleHTSCodes('auto-passenger-codes')">
                            ‚ñº Show Codes (16)
                        </button>
                        <div id="auto-passenger-codes" class="hts-code-list">
                            <div class="hts-code-grid">
                                <div class="hts-code-item">8703.22.01</div>
                                <div class="hts-code-item">8703.23.01</div>
                                <div class="hts-code-item">8703.24.01</div>
                                <div class="hts-code-item">8703.31.01</div>
                                <div class="hts-code-item">8703.32.01</div>
                                <div class="hts-code-item">8703.33.01</div>
                                <div class="hts-code-item">8703.40.00</div>
                                <div class="hts-code-item">8703.50.00</div>
                                <div class="hts-code-item">8703.60.00</div>
                                <div class="hts-code-item">8703.70.00</div>
                                <div class="hts-code-item">8703.80.00</div>
                                <div class="hts-code-item">8703.90.01</div>
                                <div class="hts-code-item">8704.21.01</div>
                                <div class="hts-code-item">8704.31.01</div>
                                <div class="hts-code-item">8704.41.00</div>
                                <div class="hts-code-item">8704.51.00</div>
                            </div>
                        </div>
                        <br>

                        2. <strong>Medium/Heavy duty vehicles completed</strong> - 24 HTS codes
                        <button class="hts-code-toggle" onclick="toggleHTSCodes('auto-mhd-codes')">
                            ‚ñº Show Codes (24)
                        </button>
                        <div id="auto-mhd-codes" class="hts-code-list">
                            <div class="hts-code-grid">
                                <div class="hts-code-item">8701.21.00</div>
                                <div class="hts-code-item">8701.22.00</div>
                                <div class="hts-code-item">8701.23.00</div>
                                <div class="hts-code-item">8701.24.00</div>
                                <div class="hts-code-item">8701.29.00</div>
                                <div class="hts-code-item">8704.10.10</div>
                                <div class="hts-code-item">8704.10.50</div>
                                <div class="hts-code-item">8704.22.10</div>
                                <div class="hts-code-item">8704.22.50</div>
                                <div class="hts-code-item">8704.23.00</div>
                                <div class="hts-code-item">8704.32.10</div>
                                <div class="hts-code-item">8704.32.50</div>
                                <div class="hts-code-item">8704.90.01</div>
                                <div class="hts-code-item">8705.40.00</div>
                                <div class="hts-code-item">8705.90.00.80</div>
                                <div class="hts-code-item">8706.00.03</div>
                                <div class="hts-code-item">8706.00.15</div>
                                <div class="hts-code-item">8706.00.25</div>
                                <div class="hts-code-item">8706.00.50</div>
                                <div class="hts-code-item">8709.11.00</div>
                                <div class="hts-code-item">8709.19.00</div>
                                <div class="hts-code-item">8709.90.00</div>
                            </div>
                        </div>
                        <br>

                        3. <strong>Automobile parts</strong> - 90+ HTS codes<br>
                        &nbsp;&nbsp;&nbsp;<em>Rubber, metals, electrical, drivetrain components (4009*, 4011*, 7007*, 8407-8708*, 8511*, 8536*, etc.)</em><br><br>

                        4. <strong>MHD vehicle parts</strong> - 160+ HTS codes<br>
                        &nbsp;&nbsp;&nbsp;<em>Similar to auto parts but for medium/heavy duty vehicles</em><br><br>

                        <strong>Calculation Formula:</strong><br>
                        ‚Ä¢ Base rate: 25%<br>
                        ‚Ä¢ Auto rebate: 3.75% √ó 33% = <strong>-1.2375%</strong><br>
                        ‚Ä¢ Effective rate before USMCA: <strong>23.7625%</strong><br><br>
                        <strong>USMCA Exemption (CA/MX only):</strong><br>
                        ‚Ä¢ Adjusted share = USMCA share √ó 40% US content<br>
                        ‚Ä¢ Canada: 91.36% √ó 40% = <strong>36.54% exemption</strong> ‚Üí Final: 15.08%<br>
                        ‚Ä¢ Mexico: 71.45% √ó 40% = <strong>28.58% exemption</strong> ‚Üí Final: 16.98%<br>
                        ‚Ä¢ Exemption codes: 9903.01.26 (CA), 9903.01.27 (MX)<br><br>
                        <em>Based on current USMCA provisions and CBP guidance</em>
                    </div>
                </div>

                <h3 style="margin-top: 30px;">Section 232 - Buses (Heading 8702)</h3>
                <div class="tree-node applies">
                    <div class="node-label">Tariff Code (10% rate) - ACTIVE</div>
                    <div class="node-content">
                        <strong>‚úÖ IMPLEMENTED</strong><br><br>
                        <strong>Complete HTS Code List (10 codes):</strong><br>
                        <span class="node-code">87021031</span>
                        <span class="node-code">87021061</span>
                        <span class="node-code">87022031</span>
                        <span class="node-code">87022061</span>
                        <span class="node-code">87023031</span>
                        <span class="node-code">87023061</span>
                        <span class="node-code">87024031</span>
                        <span class="node-code">87024061</span>
                        <span class="node-code">87029031</span>
                        <span class="node-code">87029061</span><br><br>
                        <strong>Rate:</strong> 10% ad valorem (flat, no rebates)<br>
                        <strong>USMCA:</strong> ‚ùå No exemptions available<br>
                        <em>Based on current CBP guidance and Federal Register notices</em>
                    </div>
                </div>

                <div class="info-box" style="background: #fff3cd; border-left: 4px solid #ffc107;">
                    <strong>üö® CRITICAL: Section 232 HTS Code Priority</strong>
                    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                        <li><strong>HTS Code Classification Takes Priority:</strong> Section 232 automotive and buses tariffs are based on specific HTS codes and are checked FIRST</li>
                        <li><strong>Mutual Exclusivity with Material Tariffs:</strong> If a product is classified under automotive (8703.*, 8704.*, etc.) or buses (8702.*) HTS codes, the material composition tariffs (steel, aluminum, copper, lumber) do NOT apply</li>
                        <li><strong>Example:</strong> A car (HTS 8703.23.01) made of 70% steel is subject to automotive Section 232 (23.76% effective rate), NOT steel Section 232 (25% rate on steel portion)</li>
                        <li><strong>Material Tariffs ONLY Apply:</strong> To products that are NOT classified under automotive/buses HTS codes</li>
                        <li><strong>IEEPA Reciprocal Exclusivity:</strong> Section 232 metal tariffs are also MUTUALLY EXCLUSIVE with IEEPA Reciprocal (exemption 9903.01.33)</li>
                    </ul>
                </div>

                <h3 style="margin-top: 30px;">Section 301 - China Tariffs</h3>
                <div class="tree-node applies">
                    <div class="node-label">Tariff Codes (7.5%-25% rates)</div>
                    <div class="node-content">
                        <span class="node-code">9903.88.01</span>
                        <span class="node-code">9903.88.02</span>
                        <span class="node-code">9903.88.03</span>
                        <span class="node-code">9903.88.04</span>
                        <span class="node-code">9903.88.15</span>
                        <span class="node-code">9903.88.16</span>
                        <span class="node-code">9903.88.37</span>
                        <span class="node-code">9903.88.38</span>
                        <br><em>And many others - rates vary by USTR list</em>
                    </div>
                </div>

                <div class="tree-node exempt">
                    <div class="node-label">Exemption Codes</div>
                    <div class="node-content">
                        <strong>9903.88.69:</strong> USTR product-specific exclusions (164 exclusions)<br>
                        <strong>9903.88.70:</strong> Manufacturing equipment exclusions (14 exclusions)<br>
                        <strong>9903.88.46:</strong> Articles with China content less than 75%
                    </div>
                </div>

                <h3 style="margin-top: 30px;">IEEPA - Country-Specific Tariffs</h3>
                <div class="tree-node applies">
                    <div class="node-label">Canada IEEPA (25%)</div>
                    <div class="node-content">
                        <strong>Coverage:</strong> <span class="node-code">9903.01.01</span> through <span class="node-code">9903.01.15</span><br>
                        <strong>Effective:</strong> March 4, 2025

                        <button class="hts-code-toggle" onclick="toggleHTSCodes('canada-ieepa-codes')">
                            ‚ñº Show HTS Codes (15)
                        </button>

                        <div id="canada-ieepa-codes" class="hts-code-list">
                            <strong>All Canada IEEPA Codes:</strong>
                            <div class="hts-code-grid">
                                <div class="hts-code-item">9903.01.01</div>
                                <div class="hts-code-item">9903.01.02</div>
                                <div class="hts-code-item">9903.01.03</div>
                                <div class="hts-code-item">9903.01.04</div>
                                <div class="hts-code-item">9903.01.05</div>
                                <div class="hts-code-item">9903.01.06</div>
                                <div class="hts-code-item">9903.01.07</div>
                                <div class="hts-code-item">9903.01.08</div>
                                <div class="hts-code-item">9903.01.09</div>
                                <div class="hts-code-item">9903.01.10</div>
                                <div class="hts-code-item">9903.01.11</div>
                                <div class="hts-code-item">9903.01.12</div>
                                <div class="hts-code-item">9903.01.13</div>
                                <div class="hts-code-item">9903.01.14</div>
                                <div class="hts-code-item">9903.01.15</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tree-node applies">
                    <div class="node-label">Mexico IEEPA (25%)</div>
                    <div class="node-content">
                        <strong>Coverage:</strong> <span class="node-code">9903.01.01</span> through <span class="node-code">9903.01.05</span><br>
                        <strong>Effective:</strong> March 4, 2025

                        <button class="hts-code-toggle" onclick="toggleHTSCodes('mexico-ieepa-codes')">
                            ‚ñº Show HTS Codes (5)
                        </button>

                        <div id="mexico-ieepa-codes" class="hts-code-list">
                            <strong>All Mexico IEEPA Codes:</strong>
                            <div class="hts-code-grid">
                                <div class="hts-code-item">9903.01.01</div>
                                <div class="hts-code-item">9903.01.02</div>
                                <div class="hts-code-item">9903.01.03</div>
                                <div class="hts-code-item">9903.01.04</div>
                                <div class="hts-code-item">9903.01.05</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tree-node applies">
                    <div class="node-label">China Country-Specific IEEPA (25%)</div>
                    <div class="node-content">
                        <span class="node-code">9903.01.20</span>
                        <span class="node-code">9903.01.24</span>
                        <br>Effective: February 4, 2025
                    </div>
                </div>

                <div class="tree-node exempt">
                    <div class="node-label">IEEPA Country-Specific Exemptions</div>
                    <div class="node-content">
                        <strong>9903.01.13:</strong> Canadian energy/energy resources (10% rate instead of 25%)<br>
                        <strong>9903.01.26:</strong> Canadian goods qualifying under USMCA (effective 3/7/25)<br>
                        <strong>9903.01.27:</strong> Mexican goods qualifying under USMCA (effective 3/7/25)<br>
                        <strong>Chapter 98 Exemptions:</strong> 9802.00.40, 9802.00.50, 9802.00.60, 9802.00.80, 9813
                    </div>
                </div>

                <h3 style="margin-top: 30px;">IEEPA - Reciprocal Tariffs</h3>
                <div class="info-box">
                    <strong>‚ö†Ô∏è UPDATED August 2025 per CSMS #65829726</strong><br>
                    Effective: August 7, 2025 at 12:01 a.m. EDT<br>
                    Now applies to ALL countries (not just China)
                </div>

                <div class="tree-node applies">
                    <div class="node-label">Tariff Codes</div>
                    <div class="node-content">
                        <span class="node-code">9903.01.25</span> Baseline 10% for China/HK/MO<br>
                        <strong>EU Special:</strong> If Column 1 rate ‚â•15%: 0% reciprocal; If <15%: adjusted to total 15%
                    </div>
                </div>

                <div class="tree-node exempt">
                    <div class="node-label">Exemption Codes</div>
                    <div class="node-content">
                        <strong>üÜï 9903.01.29:</strong> Column 2 rate countries (Belarus, Cuba, North Korea, Russia)<br>
                        <strong>üÜï 9903.01.30:</strong> Humanitarian donations (food, clothing, medicine)<br>
                        <strong>9903.01.21:</strong> Informational materials (books, films, CDs, artwork)<br>
                        <strong>9903.01.22:</strong> Informational materials (additional categories)<br>
                        <strong>9903.01.03:</strong> Informational materials (Mexico-specific)<br>
                        <strong>9903.01.12:</strong> Informational materials (Canada-specific)<br>
                        <strong>9903.01.31:</strong> Informational materials (general)<br>
                        <strong>9903.01.28:</strong> In-transit goods (loaded before Aug 7, entered Aug 7 - Oct 5, 2025)<br>
                        <strong>9903.01.32:</strong> Annex II commodities (applies to articles of any country)<br>
                        <strong>9903.01.33:</strong> Products subject to Section 232 (metal portion exempt)<br>
                        <strong>9903.01.34:</strong> Products with ‚â•20% US-originating content<br>
                        <strong>Chapter 98:</strong> 9802.00.40, 9802.00.50, 9802.00.60, 9802.00.80, 9813<br>
                        <strong>Preferential Programs:</strong> 9819 (AGOA), 9820 (CBTPA/HOPE), 9822 (FTAs)
                    </div>
                </div>

                <div class="info-box" style="margin-top: 15px;">
                    <strong>‚ö†Ô∏è Transshipment Penalty:</strong> Goods determined by CBP to have been transshipped to evade IEEPA Reciprocal duties are subject to an additional 40% ad valorem duty.
                </div>

                <h3 style="margin-top: 30px;">IEEPA - Fentanyl Tariff</h3>
                <div class="tree-node applies">
                    <div class="node-label">Tariff Code (15% rate)</div>
                    <div class="node-content">
                        <span class="node-code">9903.01.36</span> IEEPA Fentanyl
                        <br><strong>No exemptions available - applies to 100% of product value</strong>
                    </div>
                </div>

                <h3 style="margin-top: 30px;">Chapter 98 - General Exemptions</h3>
                <div class="tree-node exempt">
                    <div class="node-label">Applicable to ALL IEEPA Tariffs</div>
                    <div class="node-content">
                        <strong>9802.00.40:</strong> Articles returned after repair<br>
                        <strong>9802.00.50:</strong> Articles returned after alteration<br>
                        <strong>9802.00.60:</strong> Articles returned after processing<br>
                        <strong>9802.00.80:</strong> Articles assembled abroad from U.S. components<br>
                        <strong>9813:</strong> Temporary Importation Under Bond (TIB)
                    </div>
                </div>

                <h3 style="margin-top: 30px;">Preferential Trade Programs</h3>
                <div class="tree-node exempt">
                    <div class="node-label">Exempts from IEEPA Reciprocal (if properly claimed)</div>
                    <div class="node-content">
                        <strong>9819:</strong> AGOA (African Growth and Opportunity Act)<br>
                        <strong>9820:</strong> CBTPA/Haiti HOPE (Caribbean Basin Trade Partnership Act)<br>
                        <strong>9822:</strong> Various Free Trade Agreements (FTAs)
                        <br><em>Per General Note 3(c)(i)</em>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 30px;">
                    <strong>üìö Sources:</strong>
                    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                        <li>CBP IEEPA FAQ: <a href="https://www.cbp.gov/trade/programs-administration/trade-remedies/IEEPA-FAQ" target="_blank">https://www.cbp.gov/trade/programs-administration/trade-remedies/IEEPA-FAQ</a></li>
                        <li>Presidential Proclamations (2018-2025)</li>
                        <li>USTR Federal Register Notices</li>
                        <li>19 U.S.C. ¬ß 1401a (customs value rules)</li>
                        <li>19 CFR 141.57 (split shipments)</li>
                    </ul>
                </div>

                <a href="#" onclick="showTab('overview'); return false;" class="back-link">‚Üê Back to Overview</a>
            </div>

            <!-- Section 232 Copper Tab -->
            <div id="section232-copper" class="tree-section">
                <h2>Section 232 Copper Derivatives Decision Tree</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    <strong>Rate:</strong> 50% ad valorem<br>
                    <strong>Coverage:</strong> 44 HTS codes for copper derivatives<br>
                    <strong>Status:</strong> ‚úÖ ACTIVE & IMPLEMENTED
                </p>

                <div class="info-box">
                    <strong>üìã Key Facts:</strong> Copper DOES have its own Section 232 tariff at 50% rate (per Yale Budget Lab data).
                    Previously documented incorrectly as "no Section 232 tariff."
                </div>

                <div class="tree-node decision">
                    <div class="node-label">Product has copper content?</div>
                    <div class="node-content">
                        Question: "What percentage of the product (by value) is copper?"
                    </div>
                </div>

                <div class="tree-node exempt">
                    <div class="node-label">IF copper percentage = 0%</div>
                    <div class="node-content">
                        <strong>NOT APPLICABLE</strong><br>
                        Exemption: N/A<br>
                        Reasoning: Product has 0% copper composition<br>
                        Duty: $0
                    </div>
                </div>

                <div class="tree-node decision">
                    <div class="node-label">IF copper percentage > 0% AND origin is CA or MX</div>
                    <div class="node-content">
                        Question: "Does this product qualify for USMCA?"
                    </div>
                </div>

                <div class="tree-node exempt">
                    <div class="node-label">IF USMCA qualified</div>
                    <div class="node-content">
                        <strong>EXEMPT</strong><br>
                        Exemption Code: 9903.01.26 (Canada) or 9903.01.27 (Mexico)<br>
                        Reasoning: USMCA-qualified product from CA/MX<br>
                        Duty: $0
                    </div>
                </div>

                <div class="tree-node applies">
                    <div class="node-label">ELSE: Apply to copper portion</div>
                    <div class="node-content">
                        <strong>APPLIES</strong><br>
                        Rate: 50% ad valorem<br>
                        Calculation: Product Value √ó (Copper % / 100) √ó 0.50<br>
                        <br>
                        <strong>Example:</strong><br>
                        ‚Ä¢ Product value: $10,000<br>
                        ‚Ä¢ Copper content: 30%<br>
                        ‚Ä¢ Duty: $10,000 √ó 0.30 √ó 0.50 = <strong>$1,500</strong>
                    </div>
                </div>

                <div class="stacking-order">
                    <h3>Mutual Exclusivity with IEEPA Reciprocal</h3>
                    <p>The copper portion covered by Section 232 is EXEMPT from IEEPA Reciprocal (exemption 9903.01.33).</p>
                    <p>Only the non-copper portion is subject to IEEPA Reciprocal if applicable.</p>
                </div>

                <a href="/stacking-builder" class="back-link">‚Üê Back to Stacking Builder</a>
            </div>

            <!-- Section 232 Lumber Tab -->
            <div id="section232-lumber" class="tree-section">
                <h2>Section 232 Lumber/Softwood Decision Tree</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    <strong>Coverage:</strong> ~15 HTS codes from Chapter 44 (softwood lumber)<br>
                    <strong>Rate:</strong> 10% ad valorem<br>
                    <strong>Status:</strong> ‚úÖ ACTIVE & IMPLEMENTED
                </p>

                <div class="info-box">
                    <strong>üìã Key Facts:</strong> Lumber DOES have its own Section 232 tariff at 10% rate.
                    Previously documented incorrectly as "no Section 232 tariff."
                    <br><strong>Important:</strong> NO USMCA exemptions available for lumber.
                </div>

                <div class="tree-node decision">
                    <div class="node-label">Product has lumber content?</div>
                    <div class="node-content">
                        Question: "What percentage of the product (by value) is lumber/softwood?"
                    </div>
                </div>

                <div class="tree-node exempt">
                    <div class="node-label">IF lumber percentage = 0%</div>
                    <div class="node-content">
                        <strong>NOT APPLICABLE</strong><br>
                        Exemption: N/A<br>
                        Reasoning: Product has 0% lumber composition<br>
                        Duty: $0
                    </div>
                </div>

                <div class="tree-node applies">
                    <div class="node-label">ELSE: Apply to lumber portion</div>
                    <div class="node-content">
                        <strong>APPLIES</strong><br>
                        Rate: 10% ad valorem<br>
                        Calculation: Product Value √ó (Lumber % / 100) √ó 0.10<br>
                        <strong>Note:</strong> NO USMCA exemptions available<br>
                        <br>
                        <strong>Example:</strong><br>
                        ‚Ä¢ Product value: $5,000<br>
                        ‚Ä¢ Lumber content: 80%<br>
                        ‚Ä¢ Origin: Canada (NO USMCA exemption for lumber)<br>
                        ‚Ä¢ Duty: $5,000 √ó 0.80 √ó 0.10 = <strong>$400</strong>
                    </div>
                </div>

                <div class="stacking-order">
                    <h3>Mutual Exclusivity with IEEPA Reciprocal</h3>
                    <p>The lumber portion covered by Section 232 is EXEMPT from IEEPA Reciprocal (exemption 9903.01.33).</p>
                    <p>Only the non-lumber portion is subject to IEEPA Reciprocal if applicable.</p>
                </div>

                <a href="/stacking-builder" class="back-link">‚Üê Back to Stacking Builder</a>
            </div>

            <!-- Section 232 Automotive Tab -->
            <div id="section232-automotive" class="tree-section">
                <h2>Section 232 Automotive Decision Tree</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    <strong>Coverage:</strong> 290+ HTS codes across 4 subcategories<br>
                    <strong>Base Rate:</strong> 25% ‚Üí 23.76% after auto rebate<br>
                    <strong>Status:</strong> ‚úÖ ACTIVE & FULLY IMPLEMENTED
                </p>

                <div class="info-box">
                    <strong>üöó Sophisticated Calculation Logic:</strong><br>
                    This is the most complex Section 232 category with 3-step calculation including auto rebate and adjusted USMCA share.
                </div>

                <h3>4 Subcategories (290+ HTS Codes)</h3>
                <div class="tree-node decision">
                    <div class="node-label">1. Passenger Vehicles & Light Trucks (16 codes)</div>
                    <div class="node-content">
                        87032201, 87032301, 87032401, 87033101, 87033201, 87033301, 87034000, 87035000,
                        87036000, 87037000, 87038000, 87039001, 87042101, 87043101, 87044100, 87045100
                    </div>
                </div>

                <div class="tree-node decision">
                    <div class="node-label">2. Medium/Heavy Duty Vehicles Completed (24 codes)</div>
                    <div class="node-content">
                        87012100-87012900, 87041010-87049001, 87054000, 8705900080,
                        87060003-87060050, 87091100-87091900
                    </div>
                </div>

                <div class="tree-node decision">
                    <div class="node-label">3. Automobile Parts (90+ codes)</div>
                    <div class="node-content">
                        Rubber, metals, electrical, drivetrain components<br>
                        4009*, 4011*, 4016*, 7007*, 7009*, 7320*, 8301*, 8302*, 8407*, 8408*, 8409*,
                        8413*, 8414*, 8415*, 8482*, 8483*, 8501-8512*, 8527*, 8536*, 8539*, 8706-8708*, 9015*, 9029*, 9401*
                    </div>
                </div>

                <div class="tree-node decision">
                    <div class="node-label">4. MHD Vehicle Parts (160+ codes)</div>
                    <div class="node-content">
                        Similar to auto parts but for medium/heavy duty vehicles<br>
                        Expanded coverage of electrical, hydraulic, and mechanical components
                    </div>
                </div>

                <h3 style="margin-top: 30px;">Step-by-Step Calculation</h3>

                <div class="tree-node applies">
                    <div class="node-label">STEP 1: Base Rate</div>
                    <div class="node-content">
                        <strong>25% ad valorem</strong> applies to ALL 4 automotive subcategories
                    </div>
                </div>

                <div class="tree-node applies">
                    <div class="node-label">STEP 2: Auto Rebate (ALL automotive)</div>
                    <div class="node-content">
                        <strong>Formula:</strong> 3.75% √ó 33% = 1.2375 percentage points reduction<br>
                        <strong>Reasoning:</strong> US assembly incentive (33% assumed US assembly share)<br>
                        <strong>Result:</strong> 25% - 1.2375% = <strong>23.7625% effective rate</strong>
                    </div>
                </div>

                <div class="tree-node decision">
                    <div class="node-label">STEP 3: USMCA Exemption (CA/MX only)</div>
                    <div class="node-content">
                        <strong>Question:</strong> "Does this product qualify for USMCA?"
                    </div>
                </div>

                <div class="tree-node exempt">
                    <div class="node-label">IF USMCA qualified from Canada</div>
                    <div class="node-content">
                        <strong>PARTIALLY EXEMPT</strong><br>
                        Exemption Code: 9903.01.26<br>
                        <strong>Adjusted USMCA Share:</strong> 91.36% √ó 40% US content = 36.54%<br>
                        <strong>Final Rate:</strong> 23.7625% √ó (1 - 0.3654) = <strong>15.08%</strong><br>
                        <br>
                        <strong>Example:</strong><br>
                        ‚Ä¢ Product: Auto part from Canada<br>
                        ‚Ä¢ Value: $5,000<br>
                        ‚Ä¢ Duty: $5,000 √ó 0.1508 = <strong>$754</strong>
                    </div>
                </div>

                <div class="tree-node exempt">
                    <div class="node-label">IF USMCA qualified from Mexico</div>
                    <div class="node-content">
                        <strong>PARTIALLY EXEMPT</strong><br>
                        Exemption Code: 9903.01.27<br>
                        <strong>Adjusted USMCA Share:</strong> 71.45% √ó 40% US content = 28.58%<br>
                        <strong>Final Rate:</strong> 23.7625% √ó (1 - 0.2858) = <strong>16.98%</strong><br>
                        <br>
                        <strong>Example:</strong><br>
                        ‚Ä¢ Product: Passenger vehicle from Mexico<br>
                        ‚Ä¢ Value: $25,000<br>
                        ‚Ä¢ Duty: $25,000 √ó 0.1698 = <strong>$4,245</strong>
                    </div>
                </div>

                <div class="tree-node applies">
                    <div class="node-label">ELSE: No USMCA exemption</div>
                    <div class="node-content">
                        <strong>APPLIES</strong><br>
                        Rate: 23.7625% (after auto rebate only)<br>
                        <br>
                        <strong>Example (not USMCA qualified):</strong><br>
                        ‚Ä¢ Product: MHD vehicle from Mexico<br>
                        ‚Ä¢ Value: $80,000<br>
                        ‚Ä¢ USMCA: No<br>
                        ‚Ä¢ Duty: $80,000 √ó 0.237625 = <strong>$19,010</strong>
                        <br><br>
                        <strong>Example (from China):</strong><br>
                        ‚Ä¢ Product: Auto part from China<br>
                        ‚Ä¢ Value: $3,000<br>
                        ‚Ä¢ Duty: $3,000 √ó 0.237625 = <strong>$712.88</strong>
                    </div>
                </div>

                <div class="stacking-order">
                    <h3>Key Parameters (from Yale Budget Lab)</h3>
                    <ul>
                        <li><strong>AUTO_REBATE_RATE:</strong> 3.75%</li>
                        <li><strong>US_ASSEMBLY_SHARE:</strong> 33%</li>
                        <li><strong>US_AUTO_CONTENT_SHARE:</strong> 40%</li>
                        <li><strong>USMCA Share (Canada):</strong> 91.36%</li>
                        <li><strong>USMCA Share (Mexico):</strong> 71.45%</li>
                    </ul>
                </div>

                <a href="/stacking-builder" class="back-link">‚Üê Back to Stacking Builder</a>
            </div>

            <!-- Section 232 Buses Tab -->
            <div id="section232-buses" class="tree-section">
                <h2>Section 232 Buses (Heading 8702) Decision Tree</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    <strong>HTS Codes:</strong> 10 codes from Heading 8702<br>
                    <strong>Rate:</strong> 10% ad valorem<br>
                    <strong>Status:</strong> ‚úÖ ACTIVE & IMPLEMENTED
                </p>

                <div class="info-box">
                    <strong>üöå Simple Logic:</strong> Flat 10% rate, NO USMCA exemptions, NO auto rebate.
                </div>

                <h3>Complete HTS Code List (10 codes)</h3>
                <div class="tree-node decision">
                    <div class="node-label">Heading 8702 - Buses</div>
                    <div class="node-content">
                        <span class="node-code">87021031</span>
                        <span class="node-code">87021061</span>
                        <span class="node-code">87022031</span>
                        <span class="node-code">87022061</span>
                        <span class="node-code">87023031</span>
                        <span class="node-code">87023061</span>
                        <span class="node-code">87024031</span>
                        <span class="node-code">87024061</span>
                        <span class="node-code">87029031</span>
                        <span class="node-code">87029061</span>
                    </div>
                </div>

                <div class="tree-node applies">
                    <div class="node-label">Logic: Simple Application</div>
                    <div class="node-content">
                        <strong>APPLIES</strong><br>
                        Rate: 10% ad valorem (flat rate)<br>
                        <strong>No auto rebate</strong> (buses not in auto_tariffs list)<br>
                        <strong>No USMCA exemptions</strong> (per Yale data)<br>
                        <br>
                        <strong>Calculation:</strong> Product Value √ó 0.10<br>
                        <br>
                        <strong>Example:</strong><br>
                        ‚Ä¢ Product: Bus from Canada<br>
                        ‚Ä¢ Value: $100,000<br>
                        ‚Ä¢ USMCA: Qualified (but NO exemption available for buses)<br>
                        ‚Ä¢ Duty: $100,000 √ó 0.10 = <strong>$10,000</strong>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 20px; background: #fff3cd; border-color: #ffc107;">
                    <strong>‚ö†Ô∏è Important Note:</strong><br>
                    Unlike automotive categories, buses do NOT get:
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>‚ùå Auto rebate (not included in auto_tariffs list)</li>
                        <li>‚ùå USMCA exemptions (usmca_exempt: 0 in Yale config)</li>
                    </ul>
                    This results in a simple 10% flat rate for all origins.
                </div>

                <a href="/stacking-builder" class="back-link">‚Üê Back to Stacking Builder</a>
            </div>

            <!-- Section 232 Steel Tab -->
            <div id="section232-steel" class="tree-section">
                <h2>Section 232 Steel Decision Tree</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    <strong>HS Codes:</strong> 9903.81.04, 9903.81.06, 9903.81.11, 9903.81.12, 9903.81.19, 9903.81.86, 9903.81.87<br>
                    <strong>Rate:</strong> 25%<br>
                    <strong>Applies to:</strong> Steel portion of product value only
                </p>

                <div class="tree-node decision">
                    <div class="node-label">IF product contains steel</div>
                </div>

                <div class="tree-node action indent-1">
                    <div class="node-label">ASK: "What percentage of the product is steel?"</div>
                    <div class="node-content">User provides: <code>steel_pct</code> (0-100%)</div>
                </div>

                <div class="tree-node decision indent-1">
                    <div class="node-label">IF steel_pct == 0</div>
                </div>

                <div class="tree-node not-applicable indent-2">
                    <div class="node-label">‚Üí NOT APPLICABLE</div>
                    <div class="node-content">
                        Product has 0% steel composition<br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="tree-node decision indent-1">
                    <div class="node-label">ELSE IF origin == CA OR origin == MX</div>
                </div>

                <div class="tree-node action indent-2">
                    <div class="node-label">ASK: "Does product qualify for USMCA?"</div>
                </div>

                <div class="tree-node decision indent-2">
                    <div class="node-label">IF yes</div>
                </div>

                <div class="tree-node exempt indent-3">
                    <div class="node-label">‚Üí EXEMPT</div>
                    <div class="node-content">
                        USMCA-qualified product from CA/MX<br>
                        <span class="node-code">9903.01.26 (Canada)</span>
                        <span class="node-code">9903.01.27 (Mexico)</span><br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="tree-node decision indent-2">
                    <div class="node-label">IF no</div>
                </div>

                <div class="tree-node applies indent-3">
                    <div class="node-label">‚Üí APPLIES</div>
                    <div class="node-content">
                        Product from CA/MX does not qualify for USMCA<br>
                        <div class="formula">
                            final_amount = value √ó (steel_pct / 100) √ó 0.25
                        </div>
                    </div>
                </div>

                <div class="tree-node decision indent-1">
                    <div class="node-label">ELSE (other origins)</div>
                </div>

                <div class="tree-node action indent-2">
                    <div class="node-label">ASK: "Country of origin for steel?"</div>
                    <div class="node-content">User provides: <code>steel_origin</code></div>
                </div>

                <div class="tree-node decision indent-2">
                    <div class="node-label">IF steel_origin == US</div>
                </div>

                <div class="tree-node action indent-3">
                    <div class="node-label">ASK: "Was steel melted AND poured in the United States?"</div>
                </div>

                <div class="tree-node decision indent-3">
                    <div class="node-label">IF yes</div>
                </div>

                <div class="tree-node exempt indent-4">
                    <div class="node-label">‚Üí EXEMPT</div>
                    <div class="node-content">
                        Steel melted and poured in USA<br>
                        <span class="node-code">9903.81.92</span><br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="tree-node decision indent-3">
                    <div class="node-label">IF no</div>
                </div>

                <div class="tree-node applies indent-4">
                    <div class="node-label">‚Üí APPLIES</div>
                    <div class="node-content">
                        Steel from US but not melted/poured in US<br>
                        <div class="formula">
                            final_amount = value √ó (steel_pct / 100) √ó 0.25
                        </div>
                    </div>
                </div>

                <div class="tree-node decision indent-2">
                    <div class="node-label">ELSE (steel_origin != US)</div>
                </div>

                <div class="tree-node applies indent-3">
                    <div class="node-label">‚Üí APPLIES</div>
                    <div class="node-content">
                        Steel from non-US country<br>
                        <div class="formula">
                            final_amount = value √ó (steel_pct / 100) √ó 0.25
                        </div>
                        Example: $100 product with 60% steel from China<br>
                        ‚Üí $100 √ó 0.60 √ó 0.25 = <strong>$15.00</strong>
                    </div>
                </div>

                <a href="#" onclick="showTab('overview'); return false;" class="back-link">‚Üê Back to Overview</a>
            </div>

            <!-- Section 232 Aluminum Tab -->
            <div id="section232-aluminum" class="tree-section">
                <h2>Section 232 Aluminum Decision Tree</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    <strong>HS Codes:</strong> 9903.85.xx<br>
                    <strong>Rate:</strong> 10%<br>
                    <strong>Applies to:</strong> Aluminum portion of product value only
                </p>

                <div class="tree-node decision">
                    <div class="node-label">IF product contains aluminum</div>
                </div>

                <div class="tree-node action indent-1">
                    <div class="node-label">ASK: "What percentage of the product is aluminum?"</div>
                    <div class="node-content">User provides: <code>aluminum_pct</code> (0-100%)</div>
                </div>

                <div class="tree-node decision indent-1">
                    <div class="node-label">IF aluminum_pct == 0</div>
                </div>

                <div class="tree-node not-applicable indent-2">
                    <div class="node-label">‚Üí NOT APPLICABLE</div>
                    <div class="node-content">
                        Product has 0% aluminum composition<br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="tree-node decision indent-1">
                    <div class="node-label">ELSE IF origin == CA OR origin == MX</div>
                </div>

                <div class="tree-node action indent-2">
                    <div class="node-label">ASK: "Does product qualify for USMCA?"</div>
                </div>

                <div class="tree-node decision indent-2">
                    <div class="node-label">IF yes</div>
                </div>

                <div class="tree-node exempt indent-3">
                    <div class="node-label">‚Üí EXEMPT</div>
                    <div class="node-content">
                        USMCA-qualified product from CA/MX<br>
                        <span class="node-code">9903.01.26 (Canada)</span>
                        <span class="node-code">9903.01.27 (Mexico)</span><br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="tree-node decision indent-1">
                    <div class="node-label">ELSE (other origins)</div>
                </div>

                <div class="tree-node action indent-2">
                    <div class="node-label">ASK: "Country of origin for aluminum?"</div>
                    <div class="node-content">User provides: <code>aluminum_origin</code></div>
                </div>

                <div class="tree-node decision indent-2">
                    <div class="node-label">IF aluminum_origin == US</div>
                </div>

                <div class="tree-node action indent-3">
                    <div class="node-label">ASK: "Was aluminum smelted AND cast in the United States?"</div>
                </div>

                <div class="tree-node decision indent-3">
                    <div class="node-label">IF yes</div>
                </div>

                <div class="tree-node exempt indent-4">
                    <div class="node-label">‚Üí EXEMPT</div>
                    <div class="node-content">
                        Aluminum smelted and cast in USA<br>
                        <span class="node-code">US_ORIGIN</span><br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="tree-node decision indent-3">
                    <div class="node-label">IF no</div>
                </div>

                <div class="tree-node applies indent-4">
                    <div class="node-label">‚Üí APPLIES</div>
                    <div class="node-content">
                        Aluminum from US but not smelted/cast in US<br>
                        <div class="formula">
                            final_amount = value √ó (aluminum_pct / 100) √ó 0.10
                        </div>
                    </div>
                </div>

                <div class="tree-node decision indent-2">
                    <div class="node-label">ELSE (aluminum_origin != US)</div>
                </div>

                <div class="tree-node applies indent-3">
                    <div class="node-label">‚Üí APPLIES</div>
                    <div class="node-content">
                        Aluminum from non-US country<br>
                        <div class="formula">
                            final_amount = value √ó (aluminum_pct / 100) √ó 0.10
                        </div>
                        Example: $100 product with 40% aluminum from China<br>
                        ‚Üí $100 √ó 0.40 √ó 0.10 = <strong>$4.00</strong>
                    </div>
                </div>

                <a href="#" onclick="showTab('overview'); return false;" class="back-link">‚Üê Back to Overview</a>
            </div>

            <!-- Section 301 Tab -->
            <div id="section301" class="tree-section">
                <h2>Section 301 Decision Tree</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    <strong>HS Codes:</strong> 9903.88.xx<br>
                    <strong>Rates:</strong> 7.5%, 25% (varies by list)<br>
                    <strong>Applies to:</strong> 100% of product value
                </p>

                <div class="tree-node decision">
                    <div class="node-label">IF origin == CN OR origin == HK OR origin == MO</div>
                </div>

                <div class="tree-node action indent-1">
                    <div class="node-label">ASK: "Does product match one of the 164 USTR product-specific exclusions?"</div>
                    <div class="node-content">Check USTR Federal Register notices</div>
                </div>

                <div class="tree-node decision indent-1">
                    <div class="node-label">IF yes</div>
                </div>

                <div class="tree-node exempt indent-2">
                    <div class="node-label">‚Üí EXEMPT</div>
                    <div class="node-content">
                        Product matches USTR product-specific exclusion<br>
                        <span class="node-code">9903.88.69</span><br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="tree-node decision indent-1">
                    <div class="node-label">IF no</div>
                </div>

                <div class="tree-node action indent-2">
                    <div class="node-label">ASK: "Is product classified as manufacturing equipment under 14 USTR exclusions?"</div>
                </div>

                <div class="tree-node decision indent-2">
                    <div class="node-label">IF yes</div>
                </div>

                <div class="tree-node exempt indent-3">
                    <div class="node-label">‚Üí EXEMPT</div>
                    <div class="node-content">
                        Product classified as manufacturing equipment<br>
                        <span class="node-code">9903.88.70</span><br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="tree-node decision indent-2">
                    <div class="node-label">IF no</div>
                </div>

                <div class="tree-node applies indent-3">
                    <div class="node-label">‚Üí APPLIES</div>
                    <div class="node-content">
                        Product from China/HK/Macau, no USTR exclusions apply<br>
                        <div class="formula">
                            final_amount = value √ó rate
                        </div>
                        Example: $100 product from China at 25% rate<br>
                        ‚Üí $100 √ó 0.25 = <strong>$25.00</strong>
                    </div>
                </div>

                <div class="tree-node decision">
                    <div class="node-label">ELSE (origin != CN/HK/MO)</div>
                </div>

                <div class="tree-node not-applicable indent-1">
                    <div class="node-label">‚Üí NOT APPLICABLE</div>
                    <div class="node-content">
                        Product not from China/Hong Kong/Macau<br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong>üìå Important Note:</strong> Section 321 de minimis exemption (shipments under $800) was
                    <strong>ELIMINATED for China/Hong Kong/Macau</strong> in September 2024. Do not ask about this exemption.
                </div>

                <a href="#" onclick="showTab('overview'); return false;" class="back-link">‚Üê Back to Overview</a>
            </div>

            <!-- IEEPA Reciprocal Tab -->
            <div id="ieepa-reciprocal" class="tree-section">
                <h2>IEEPA Reciprocal Decision Tree</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    <strong>HS Codes:</strong> 9903.01.25 (baseline 10%), 9903.01.63 (China escalation 84%/125%)<br>
                    <strong>Rate:</strong> 10% baseline for CN/HK/MO; 15% threshold rule for EU/JP/KR; varies by country<br>
                    <strong>Applies to:</strong> NON-METAL portion of product value only (CRITICAL!)<br>
                    <strong>Effective:</strong> August 7, 2025 (per CSMS #65829726)
                </p>

                <div class="info-box" style="background: #fff3cd; border-left-color: #ffc107;">
                    <strong>‚ö†Ô∏è SPECIAL CALCULATION RULES BY COUNTRY:</strong>
                    <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                        <li><strong>China/Hong Kong/Macau (CN/HK/MO):</strong> 10% flat rate on non-metal portion</li>
                        <li><strong>EU Countries (27 members):</strong> 15% threshold rule - If MFN ‚â•15% ‚Üí no reciprocal; If MFN <15% ‚Üí reciprocal = 15% - MFN</li>
                        <li><strong>Japan (JP):</strong> 15% threshold rule - If MFN ‚â•15% ‚Üí no reciprocal; If MFN <15% ‚Üí reciprocal = 15% - MFN</li>
                        <li><strong>South Korea (KR):</strong> 15% threshold rule - If MFN ‚â•15% ‚Üí no reciprocal; If MFN <15% ‚Üí reciprocal = 15% - MFN</li>
                        <li><strong>Column 2 Countries (BY/CU/KP/RU):</strong> Fully exempt (9903.01.29)</li>
                        <li><strong>Humanitarian Donations:</strong> Exempt for food, clothing, medicine (9903.01.30)</li>
                    </ul>
                </div>

                <h3 style="margin-top: 25px;">Column 2 Countries - Automatic Exemption</h3>
                <div class="tree-node decision">
                    <div class="node-label">IF origin == BY OR CU OR KP OR RU</div>
                </div>

                <div class="tree-node exempt indent-1">
                    <div class="node-label">‚Üí EXEMPT (Column 2 rate countries)</div>
                    <div class="node-content">
                        Countries: Belarus (BY), Cuba (CU), North Korea (KP), Russia (RU)<br>
                        <span class="node-code">9903.01.29</span><br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <h3 style="margin-top: 25px;">EU/Japan/South Korea - 15% Threshold Rule</h3>
                <div class="tree-node decision">
                    <div class="node-label">IF origin == EU OR JP OR KR</div>
                    <div class="node-content">
                        <strong>EU Countries (27):</strong> AT, BE, BG, HR, CY, CZ, DK, EE, FI, FR, DE, GR, HU, IE, IT, LV, LT, LU, MT, NL, PL, PT, RO, SK, SI, ES, SE
                    </div>
                </div>

                <div class="tree-node action indent-1">
                    <div class="node-label">ASK: "What is the Column 1 (MFN) duty rate for this HTS code?"</div>
                    <div class="node-content">
                        User provides: <code>column_1_rate</code> (percentage)<br>
                        This is the normal Most Favored Nation duty rate from the tariff schedule
                    </div>
                </div>

                <div class="tree-node decision indent-1">
                    <div class="node-label">IF column_1_rate >= 15%</div>
                </div>

                <div class="tree-node exempt indent-2">
                    <div class="node-label">‚Üí EXEMPT (MFN rate already meets 15% threshold)</div>
                    <div class="node-content">
                        Column 1 rate already at or above 15%, so NO reciprocal tariff<br>
                        Total duty = Column 1 rate only<br>
                        <div class="formula">
                            final_amount = $0 (no reciprocal tariff)
                        </div>
                        Example: German product with 18% Column 1 rate<br>
                        ‚Üí Total duty = 18% (Column 1 only), reciprocal = $0
                    </div>
                </div>

                <div class="tree-node decision indent-1">
                    <div class="node-label">IF column_1_rate < 15%</div>
                </div>

                <div class="tree-node applies indent-2">
                    <div class="node-label">‚Üí APPLIES (Adjusted reciprocal rate)</div>
                    <div class="node-content">
                        <div class="formula">
                            adjusted_reciprocal_rate = 15% - column_1_rate<br>
                            final_amount = value √ó (non_metal_pct / 100) √ó (adjusted_reciprocal_rate / 100)
                        </div>
                        <strong>Example 1:</strong> German automotive part, $1,000 value, Column 1 rate 2.5%, 100% non-metal<br>
                        ‚Üí Reciprocal rate = 15% - 2.5% = 12.5%<br>
                        ‚Üí Final amount = $1,000 √ó 1.00 √ó 0.125 = <strong>$125.00</strong><br>
                        ‚Üí Total duty = 2.5% (Column 1) + 12.5% (Reciprocal) = <strong>15%</strong><br>
                        <br>
                        <strong>Example 2:</strong> Japanese electronics, $500 value, Column 1 rate 8%, 20% steel (80% non-metal)<br>
                        ‚Üí Reciprocal rate = 15% - 8% = 7%<br>
                        ‚Üí Applied to non-metal portion only: $500 √ó 0.80 √ó 0.07 = <strong>$28.00</strong><br>
                        ‚Üí Total duty on non-metal = 8% (Column 1) + 7% (Reciprocal) = <strong>15%</strong>
                    </div>
                </div>

                <h3 style="margin-top: 25px;">China/Hong Kong/Macau - 10% Flat Rate</h3>
                <div class="tree-node decision">
                    <div class="node-label">IF origin == CN OR origin == HK OR origin == MO</div>
                </div>

                <div class="tree-node action indent-1">
                    <div class="node-label">CALCULATE total_metal_pct</div>
                    <div class="node-content">
                        <div class="formula">
                            total_metal_pct = steel_pct + aluminum_pct + copper_pct + lumber_pct
                        </div>
                    </div>
                </div>

                <div class="tree-node action indent-1">
                    <div class="node-label">CALCULATE non_metal_pct</div>
                    <div class="node-content">
                        <div class="formula">
                            non_metal_pct = 100 - total_metal_pct
                        </div>
                    </div>
                </div>

                <div class="tree-node decision indent-1">
                    <div class="node-label">IF non_metal_pct <= 0</div>
                </div>

                <div class="tree-node not-applicable indent-2">
                    <div class="node-label">‚Üí NOT APPLICABLE</div>
                    <div class="node-content">
                        Product is 100% metal (covered by Section 232)<br>
                        <span class="node-code">9903.01.33 (metal portion exempt)</span><br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="tree-node decision indent-1">
                    <div class="node-label">IF non_metal_pct > 0</div>
                </div>

                <div class="tree-node action indent-2">
                    <div class="node-label">ASK: "Percentage of U.S.-originating content by value?"</div>
                    <div class="node-content">
                        User provides: <code>us_content_pct</code> (0-100%)<br>
                        Must be determined by physical characteristics only (19 U.S.C. ¬ß 1401a)
                    </div>
                </div>

                <div class="tree-node decision indent-2">
                    <div class="node-label">IF us_content_pct >= 20</div>
                </div>

                <div class="tree-node exempt indent-3">
                    <div class="node-label">‚Üí EXEMPT on U.S. portion</div>
                    <div class="node-content">
                        Product has ‚â•20% U.S. content<br>
                        <span class="node-code">9903.01.34</span><br>
                        <strong>CRITICAL:</strong> Requires split entry summary lines<br>
                        <div class="formula">
                            us_portion_amount = value √ó (us_content_pct / 100) √ó rate ‚Üí $0 (exempt)<br>
                            non_us_portion_amount = value √ó ((100 - us_content_pct) / 100) √ó rate ‚Üí applies
                        </div>
                        Example: $100 product, 30% US content, 70% non-US<br>
                        ‚Üí US portion: $30 √ó 0.10 = $3.00 (EXEMPT)<br>
                        ‚Üí Non-US portion: $70 √ó 0.10 = <strong>$7.00 APPLIES</strong>
                    </div>
                </div>

                <div class="tree-node decision indent-2">
                    <div class="node-label">IF us_content_pct < 20</div>
                </div>

                <div class="tree-node action indent-3">
                    <div class="node-label">ASK: "Is product informational materials (publications, films, recordings, artwork)?"</div>
                    <div class="node-content">Includes HTSUS 8523.80.10, 9701-9705</div>
                </div>

                <div class="tree-node decision indent-3">
                    <div class="node-label">IF yes</div>
                </div>

                <div class="tree-node exempt indent-4">
                    <div class="node-label">‚Üí EXEMPT</div>
                    <div class="node-content">
                        Product is informational materials<br>
                        <span class="node-code">9903.01.21, 9903.01.22, 9903.01.12, 9903.01.03, 9903.01.31</span><br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="tree-node decision indent-3">
                    <div class="node-label">IF no</div>
                </div>

                <div class="tree-node applies indent-4">
                    <div class="node-label">‚Üí APPLIES to NON-METAL portion</div>
                    <div class="node-content">
                        <div class="formula">
                            final_amount = value √ó (non_metal_pct / 100) √ó rate
                        </div>
                        Example: $100 product, 60% steel, 40% non-metal<br>
                        ‚Üí $100 √ó 0.40 √ó 0.10 = <strong>$4.00</strong><br>
                        <br>
                        <strong>Entry Requirement:</strong> Split entry summary lines<br>
                        - Line 1: Metal portion (60% = $60) - Section 232 applies, IEEPA exempt (9903.01.33)<br>
                        - Line 2: Non-metal portion (40% = $40) - IEEPA Reciprocal applies
                    </div>
                </div>

                <div class="tree-node decision">
                    <div class="node-label">ELSE (origin != CN/HK/MO)</div>
                </div>

                <div class="tree-node not-applicable indent-1">
                    <div class="node-label">‚Üí NOT APPLICABLE</div>
                    <div class="node-content">
                        Product not from China/Hong Kong/Macau<br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong>‚ö†Ô∏è CRITICAL RULE:</strong> As of June 4, 2025, IEEPA Reciprocal applies ONLY to the
                    non-metal portion of product value. Metal portion is subject to Section 232 and exempt from
                    IEEPA Reciprocal under exemption code 9903.01.33. Must report on separate entry summary lines.
                </div>

                <a href="#" onclick="showTab('overview'); return false;" class="back-link">‚Üê Back to Overview</a>
            </div>

            <!-- IEEPA Fentanyl Tab -->
            <div id="ieepa-fentanyl" class="tree-section">
                <h2>IEEPA Fentanyl Decision Tree</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    <strong>HS Code:</strong> 9903.01.36<br>
                    <strong>Rate:</strong> 15% (or as specified by proclamation)<br>
                    <strong>Applies to:</strong> 100% of product value (ENTIRE product, not just non-metal)
                </p>

                <div class="tree-node decision">
                    <div class="node-label">IF origin == CN OR origin == HK OR origin == MO</div>
                </div>

                <div class="tree-node applies indent-1">
                    <div class="node-label">‚Üí APPLIES to ENTIRE product</div>
                    <div class="node-content">
                        <strong>NO exemptions available</strong><br>
                        <strong>NO adjustments for metal composition</strong><br>
                        <div class="formula">
                            final_amount = value √ó rate
                        </div>
                        Example: $100 product from China<br>
                        ‚Üí $100 √ó 0.15 = <strong>$15.00</strong><br>
                        <br>
                        Note: Applies to 100% of value regardless of metal/non-metal composition
                    </div>
                </div>

                <div class="tree-node decision">
                    <div class="node-label">ELSE (origin != CN/HK/MO)</div>
                </div>

                <div class="tree-node not-applicable indent-1">
                    <div class="node-label">‚Üí NOT APPLICABLE</div>
                    <div class="node-content">
                        Product not from China/Hong Kong/Macau<br>
                        <span class="node-code">final_amount = $0</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong>üìå Important Note:</strong> IEEPA Fentanyl is not commonly triggered for most products.
                    It applies based on presidential proclamation for specific time periods. When it does apply,
                    there are NO exemptions and it applies to the ENTIRE product value (unlike IEEPA Reciprocal
                    which only applies to non-metal portions).
                </div>

                <a href="#" onclick="showTab('overview'); return false;" class="back-link">‚Üê Back to Overview</a>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabId) {
            // Hide all sections
            document.querySelectorAll('.tree-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected section
            document.getElementById(tabId).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        async function checkYaleRepository() {
            const btn = document.getElementById('check-repo-btn');
            const statusContent = document.getElementById('repo-status-content');
            const detailsContent = document.getElementById('repo-details-content');
            const toggleBtn = document.getElementById('toggle-repo-btn');

            // Disable button and show loading state
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Checking...';
            statusContent.innerHTML = '<p style="margin: 0; opacity: 0.9; font-size: 14px;">Fetching latest repository data from GitHub...</p>';

            try {
                const response = await fetch('/api/check-yale-repository');
                const data = await response.json();

                if (data.success) {
                    const repo = data.repository;
                    const commits = data.latest_commits;

                    // Format last updated date
                    const lastUpdated = new Date(repo.last_updated).toLocaleString();

                    // Update status content with summary
                    statusContent.innerHTML = `
                        <div style="font-size: 14px;">
                            <div style="margin-bottom: 8px;">
                                <strong>Repository:</strong>
                                <a href="${repo.url}" target="_blank" style="color: #FF6600; text-decoration: underline;">${repo.name}</a>
                                <span style="background: rgba(255, 255, 255, 0.2); padding: 3px 8px; border-radius: 3px; margin-left: 10px; font-size: 12px;">‚≠ê ${repo.stars} stars</span>
                            </div>
                            <div style="font-size: 13px; opacity: 0.9;">
                                <strong>Last Updated:</strong> ${lastUpdated}
                            </div>
                        </div>
                    `;

                    // Build commits HTML for details section
                    let commitsHtml = '<div><strong style="font-size: 15px;">Latest 5 Commits:</strong><ul style="margin-top: 10px; padding-left: 20px; line-height: 1.8;">';
                    commits.forEach(commit => {
                        const commitDate = new Date(commit.date).toLocaleDateString();
                        commitsHtml += `
                            <li style="margin-bottom: 8px; font-size: 13px;">
                                <code style="background: rgba(255, 255, 255, 0.2); padding: 2px 6px; border-radius: 3px; font-size: 12px;">${commit.sha}</code>
                                <strong>${commit.message}</strong>
                                <br>
                                <span style="opacity: 0.8; font-size: 12px;">by ${commit.author} on ${commitDate}</span>
                            </li>
                        `;
                    });
                    commitsHtml += '</ul></div>';

                    detailsContent.innerHTML = `
                        <div style="font-size: 14px;">
                            <div style="margin-bottom: 15px;">
                                <strong style="font-size: 15px;">Description:</strong> ${repo.description || 'No description'}
                            </div>
                            ${commitsHtml}
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.2); font-size: 12px; opacity: 0.8;">
                                Last checked: ${new Date(data.checked_at).toLocaleString()}
                            </div>
                        </div>
                    `;

                    // Show details and toggle button
                    detailsContent.style.display = 'block';
                    toggleBtn.style.display = 'inline-block';
                    toggleBtn.innerHTML = '‚ñ≤ Collapse';
                } else {
                    statusContent.innerHTML = `<p style="margin: 0; color: #FFD700; font-size: 14px;">‚ö†Ô∏è Error: ${data.error}</p>`;
                    detailsContent.style.display = 'none';
                    toggleBtn.style.display = 'none';
                }
            } catch (error) {
                statusContent.innerHTML = `<p style="margin: 0; color: #FFD700; font-size: 14px;">‚ö†Ô∏è Failed to fetch repository data: ${error.message}</p>`;
                detailsContent.style.display = 'none';
                toggleBtn.style.display = 'none';
            } finally {
                // Re-enable button
                btn.disabled = false;
                btn.innerHTML = 'üîÑ Check for Updates';
            }
        }

        function toggleRepoDetails() {
            const detailsContent = document.getElementById('repo-details-content');
            const toggleBtn = document.getElementById('toggle-repo-btn');

            if (detailsContent.style.display === 'none') {
                detailsContent.style.display = 'block';
                toggleBtn.innerHTML = '‚ñ≤ Collapse';
            } else {
                detailsContent.style.display = 'none';
                toggleBtn.innerHTML = '‚ñº Expand';
            }
        }

        function toggleHTSCodes(listId) {
            const list = document.getElementById(listId);
            const button = event.target;

            if (list.classList.contains('expanded')) {
                list.classList.remove('expanded');
                button.innerHTML = button.innerHTML.replace('‚ñ≤ Hide', '‚ñº Show');
            } else {
                list.classList.add('expanded');
                button.innerHTML = button.innerHTML.replace('‚ñº Show', '‚ñ≤ Hide');
            }
        }
    </script>
</body>
</html>
